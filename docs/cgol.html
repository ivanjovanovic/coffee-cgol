<!DOCTYPE html>  <html> <head>   <title>cgol.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="application.html">                 application.coffee               </a>                                           <a class="source" href="cgol.html">                 cgol.coffee               </a>                                           <a class="source" href="renderer.canvas.html">                 renderer.canvas.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               cgol.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Model implementation for the Conway's Game of Life logic</h3>

<p>It contains logic of the game with sevral methods to influence current state of the game
like setting new cells to life or death or produce new generation as well to 
initialize game with ceratain grid size.</p>

<p>Grid is represented with one-dimensional array of length Width x Height. There are methods
to calculate from array index to grid coordinate and back.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Put model in safely namespaced object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs = </span><span class="p">{}</span>
<span class="nv">rs.ji = </span><span class="p">{}</span>
<span class="nv">rs.ji.cgol = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Since CoffeeScript wrap everything in the closures
we export cgol to window object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root = </span><span class="nx">exports</span> <span class="o">?</span> <span class="k">this</span>
<span class="nv">root.rs = </span><span class="nx">rs</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Initializaton of the game with field size</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.init = </span><span class="nf">(field_size) -&gt;</span>
  <span class="nv">rs.ji.cgol.field_size = </span><span class="nx">field_size</span>
  <span class="nv">rs.ji.cgol.current_generation = </span><span class="p">(</span><span class="mi">0</span> <span class="k">for</span> <span class="nx">num</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">field_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>gets current state of the cell on given coordinate pair (x, y)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.getCell = </span><span class="nf">(x, y) -&gt;</span>
  <span class="nv">cell = </span><span class="kc">undefined</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nv">cell = </span><span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">current_generation</span><span class="p">[</span><span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">get_from_coords</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span>
  <span class="nx">cell</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>sets value for the cell on given coordinate pair (x, y)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.setCell = </span><span class="nf">(x, y, value) -&gt;</span>
  <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">current_generation</span><span class="p">[</span><span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">get_from_coords</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>gets coordinate pair for given array index</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.get_coords = </span><span class="nf">(index) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid index&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid index&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nv">x = </span><span class="nx">index</span> <span class="o">%</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span>
  <span class="nv">y = </span><span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span>
  <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>gets array index from given coordinate pair</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.get_from_coords = </span><span class="nf">(x, y) -&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid coordinates&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Invalid coordinates&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">field_size</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Decides destiny for the cell in the next generation according
to state of its neighbours in current generation</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.decide_destiny_for = </span><span class="nf">(x, y) -&gt;</span>
  <span class="nv">cell = </span><span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
  <span class="nv">neighbours = </span><span class="p">[</span>
    <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="p">),</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
    <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
    <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="p">),</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">getCell</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">]</span>

  <span class="nv">reducer = </span><span class="nf">(sum, val) -&gt;</span>
    <span class="nv">val = </span><span class="mi">0</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">val</span>

  <span class="nv">sum = </span><span class="nx">neighbours</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>the one and only true logic of this game (4 rules of the game)
see on Wikipedia</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">sum</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">sum</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sum</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">sum</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="mi">1</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">sum</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">sum</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="mi">1</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">sum</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>generates new generation by mapping a function which decides 
destiny of the cells to the array</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rs.ji.cgol.generate = </span><span class="o">-&gt;</span>
  <span class="nv">map = </span><span class="nf">(i, cell) -&gt;</span> 
    <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">get_coords</span> <span class="nx">i</span>
    <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">decide_destiny_for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>

  <span class="p">(</span><span class="nx">map</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">cell</span> <span class="k">for</span> <span class="nx">cell</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">ji</span><span class="p">.</span><span class="nx">cgol</span><span class="p">.</span><span class="nx">current_generation</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 